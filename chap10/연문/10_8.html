<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>산수를 풀어 봅시다</title>
	<style>
		td {
			padding-left: 10px;
			padding-right: 10px;
		}
	</style>
	<script>
		let timeoutId; // 자동 채점을 위한 타이머 ID

		function calc() {
			let total = 0;
			let qArray = document.getElementsByClassName("question");
			let aArray = document.getElementsByClassName("answer");
			for (let i = 0; i < qArray.length; i++) {
				let question = qArray[i].innerHTML;
				let correctAnswer = Math.floor(eval(question));
				let userAnswer = aArray[i].value;
				if (userAnswer == "" || isNaN(userAnswer)) {
					total += 0;
					qArray[i].style.textDecoration = "line-through";
				}
				else if (parseInt(userAnswer) == correctAnswer) {
					total += 1;
					qArray[i].style.textDecoration = "none";
				}
				else {
					total += 0;
					qArray[i].style.textDecoration = "line-through";
				}
			}
			document.getElementById("score").innerHTML = total;
			// 채점 후 새로운 타이머를 설정합니다.
			resetAutoCalcTimer();
		}

		function makeExpression() {
			let qArray = document.getElementsByClassName("question");
			let aArray = document.getElementsByClassName("answer");
			for (let i = 0; i < qArray.length; i++) {
				let number1 = Math.floor(Math.random() * 20) + 1;
				let number2 = Math.floor(Math.random() * 20) + 1;
				let op = Math.floor(Math.random() * 4);
				let operator = "+";
				switch (op) {
					case 0: operator = "+"; break;
					case 1: operator = "-"; break;
					case 2: operator = "*"; break;
					case 3: operator = "/"; break;
				}
				qArray[i].innerHTML = number1 + operator + number2;
				qArray[i].style.textDecoration = "none";

				aArray[i].value = "";
				document.getElementById("score").innerHTML = 0;
			}
			// 새 문제를 만들 때마다 자동 채점 타이머를 리셋합니다.
			resetAutoCalcTimer();
		}

		function resetAutoCalcTimer() {
			clearTimeout(timeoutId); // 이전 타이머가 있다면 제거합니다.
			timeoutId = setTimeout(calc, 10000); // 10초 후에 calc 함수를 호출합니다.
		}

		window.onload = function() {
			makeExpression(); // 페이지 로드 시 문제 생성 및 타이머 시작
		};
	</script>
</head>

<body>
	<h3>산수 문제를 풀어 봅시다.</h3>
	자동으로 문제가 만들어집니다. 답 입력 후 채점 버튼을 누르세요.
	다시 버튼을 누르면 새로운 문제가 출력됩니다. 나누기 결과는 정수입니다.
	<hr>
	<form>
		<table>
			<tr>
				<td class="question"></td>
				<td><input class="answer" type="text" size="8"></td>
			</tr>
			<tr>
				<td class="question"></td>
				<td><input class="answer" type="text" size="8"></td>
			</tr>
			<tr>
				<td class="question"></td>
				<td><input class="answer" type="text" size="8"></td>
			</tr>
			<tr>
				<td class="question"></td>
				<td><input class="answer" type="text" size="8"></td>
			</tr>
			<tr>
				<td><button type="button" onclick="calc()">채점</button></td>
				<td><span id="score">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button type="button" onclick="makeExpression()">다시